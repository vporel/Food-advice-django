<!--
    PAGE D'AFFICHAGE D'UN REPAS
-->
{% extends "base.html" %}
{% block title %}{{repas.nom}} | Food-advice{% endblock %}

{%block styles %}
    <!-- Inclusions css ici -->  
    {% css "css/food-show.css" %}

{% endblock %}
 
{% block body %}
<!-- Contenu de la page ici -->

<h2 id="food-title" data-aos="zoom-in">
    {{ repas.nom }}
</h2>
<div class="container">
    <div class="row">
        <div class="col-12 col-md-5">
            <img src="/{{ repas.image }}" alt="" id="food-image">
        </div>
        <div class="col-12 col-md-7" id="details">
            <div id="description" class="text-start">
                {{ repas.description }}
            </div>
            <hr>
            <div class="text-center text-md-start">
                <span class="label">Origine : </span>
                <span class="value">{% if repas.origine is not null %}{{ repas.origine }} {%else%}Non renseignée{% endif%}</span>
            </div>
            <div class="text-center text-md-start">
                <span class="label">Moment de la journée : </span>
                <span class="value">{% if repas.momentJournee is not null %}{{ repas.get_momentJournee_display }} {%else%}Non renseigné{% endif%}</span>
            </div>
            {% if repas.contributeur is not null %}
                <div>
                    <span class="label">Recommandé par : </span>
                    <span class="value">{{ repas.contributeur }}</span>
                </div>
            {% endif %}
            {% if repas.recette is not null %}
                <div id="composition" class="mt-3 text-start"  data-aos="fade-up" >
                    <h5 class="">Composition</h5>
                    {% if repas.recette.aliments.count > 0 %}
                        <div>
                            <span class="label">Taux de glucides : </span>
                            <span class="value">{{ repas.tauxGlucides }}%</span>
                        </div>
                        <div>
                            <span class="label">Taux de lipides : </span>
                            <span class="value">{{ repas.tauxLipides }}%</span>
                        </div>
                        <div>
                            <span class="label">Taux de Protéines : </span>
                            <span class="value">{{ repas.tauxProteines }}%</span>
                        </div>
                        <div>
                            <span class="label">Calories (Pour une personne) : </span>
                            <span class="value">{{ repas.caloriesUnePersonne }} Kcal</span>
                        </div>
                        <div>
                            <span class="label">Minéraux : </span>
                            <span class="value">{{ repas.mineraux }}</span>
                        </div>
                        <div>
                            <span class="label">Vitamines : </span>
                            <span class="value">{{ repas.vitamines }}</span>
                        </div>

                    {% else %}
                        <h6>Aliments dans le repas non renseignés</h6>
                    {% endif %}
                    
                </div>
                <div id="recipe" class="text-center text-md-start" data-aos="fade-in-left" >
                    <h5 class="mt-3 title">Recette</h5>
                    <div>
                        <span class="label">Nombre de personnes: </span>
                        <span class="value">{{ repas.recette.nombrePersonnes }}</span>
                    </div>
                    <div>
                        <span class="label">Temps de préparation: </span>
                        <span class="value">{{ repas.recette.tempsPreparation }} min.</span>
                    </div>
                    <div>
                        <span class="label">Temps de cuisson : </span>
                        <span class="value">{{ repas.recette.tempsCuisson }} min.</span>
                    </div>
                    <hr>
                    
                </div>
            {% else %}
                <h4>Aucune recette enregistrée</h4>
            {% endif %}
        </div>
    </div>
    
    <div class="row mb-2" >
        {% if repas.recette is not null %}
            <div class="col-12 mb-3"id="ingredients">
                <h4 class="title text-center text-md-start">Ingredients</h4>
                <div class="row">
                {% if repas.recette.aliments.count > 0 %}
                    {% for alimentRecette in repas.recette.alimentrecette_set.all %}
                        {% with aliment=alimentRecette.aliment %}
                            <a data-aos="zoom-in" class="col-4 col-md-2 ingredient aliment aliment-little-presentation" href="{% url 'show-aliment' aliment.id %}">
                                <div class="image-div">
                                    <img src="/{{ aliment.image }}" alt="" class="aliment-image">
                                </div>
                                <h5>{{ aliment.nom }}</h5>
                                <h6>{{ alimentRecette.quantite }} {% if aliment.uniteComptage != None %}({{ aliment.uniteComptage}}){% endif %}</h6>
                                
                                <div class="composition">
                                    <div>
                                        <span class="label">Lipides : </span>
                                        <span class="value">{{ aliment.tauxLipides }}%</span>
                                    </div>
                                    <div>
                                        <span class="label">Glucides : </span>
                                        <span class="value">{{ aliment.tauxGlucides }}%</span>
                                    </div>
                                    <div>
                                        <span class="label">Proteines : </span>
                                        <span class="value">{{ aliment.tauxProteines }}%</span>
                                    </div>
                                    <div>
                                        <span class="label">Calories : </span>
                                        <span class="value">{{ alimentRecette.calories }} Kcal</span>
                                    </div>
                                </div>
                            </a> 
                        {% endwith %} 
                    {% endfor %}
                {% else %}
                    <div class="col-12 mb-3">Aucun ingrédient enregistré</div>
                {% endif %}
                </div>
            </div>
            <div class="col-12"id="detail-preparation" data-aos="fade-in">
                {{ repas.recette.detailPreparation | linebreaks }}
            </div>
        {% endif %}
        <div id="ratings" class="col-12 text-center" data-aos="zoom-out">
            <div id="stars"class="d-flex justify-content-center">
                <i class="far fa-star star"></i>
                <i class="far fa-star star"></i>
                <i class="far fa-star star"></i>
                <i class="far fa-star star"></i>
                <i class="far fa-star star"></i>
            </div>
            <span><strong id="notesCount">{{ repas.nombreNotes }}</strong> personne{% if repas.nombreNotes > 1 %}s ont{% else %}a{% endif %} noté</span><br>
            <div id="user-note">
                {% call_method repas 'noteContributeur' appUser as note %}
                {%if appUser is null or note == 0 %}
                    <button class="btn btn-primary btn-noter">Noter</button>
                {% else %}
                    <span>Vous avez donné une note de <strong>{{ note }}. <a class="btn-noter text-primary">Changer</a></strong></span>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row mt-3">
        {% if autresRepas.count > 0 %}
        <div class="col-12 col-md-6 order-2 order-md-1">
            <h5 class="title">Repas du même genre</h5>
            <div class="row row-cols-3">
                {% include "load/foods.html" with repass=autresRepas%}
            </div>
        </div>
        {% endif %}
        <div class="col-12 col-md-6 order-1 order-md-2">
            <h5 class="title">Commentaires</h5>
            {%if appUser is not null %}
                <span>Ajouter un commentaire</span>
                <form id="new-comment-form">
                    <textarea id="comment-text" placeholder="Votre commentaire ici"></textarea>
                    <div class="d-flex justify-content-end mt-1">
                        <button class="btn btn-primary" id="add-comment" type="button">Ajouter</button>
                    </div>
                </form>
            {%else %}
                <a id="btn-commenter" class="text-primary">Ajouter un commentaire</a>
            {% endif %}
            <div id="commentaires" class="mt-2">
                {% include "load/comments.html" with commentaires=commentaires %}
            </div>
        </div>
    </div>
</div>
{%endblock%}
{% block scripts %}
    <!-- Code javascript ici -->
    <script>
        const NOTES_AVERAGE = parseFloat("{{ repas.moyenneNotes }}");
        const REPAS_ID = parseInt("{{ repas.id }}");
    </script>
    <script src="{% static "js/food-show.js" %}"></script>
    <script>
        updateStarsWithAverage(NOTES_AVERAGE);
    </script>
{% endblock%}